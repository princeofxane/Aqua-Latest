

{% extends "base.html" %}

{% block body_content %}



    <div class="container" style="margin-top:10%;">
        <div class="row">
            <div class="col-md-12 col-md-offset-3" style="font-size:28px;">
                <div class="float-right">Phone Number is <span id="phoneNumber"></span></div>
            </div>
        </div> 
        
        <br><br>

        <div class="row" style="margin-top:5%">
            <div class=" col-md-6 col-md-offset-3">
                <form class="">
                    <div class="form-group" >
                        <label for="Fname">Full Name</label>
                        <input id="leadName" type="text" class="form-control" placeholder="First Name">
                    </div>
                    <!-- <div class="form-group" >
                        <label for="lname">Last Name</label>
                        <input type="text" class="form-control" placeholder="Last Name">
                    </div> -->
                    <div class="form-group" >
                        <label for="address">Address</label>
                        <!-- <input type="text" class="form-control" placeholder="Address"> -->
                        <textarea id="address" class="form-control" rows="4" placeholder="Address"></textarea>
                    </div>
                    <div class="form-group" >
                        <label for="alternateNumber">Alternate Number</label>
                        <input id="alternatePhone" type="text" class="form-control" value="9795768765" placeholder="Alternate Number">
                    </div>
                    <div class="form-group" >
                        <label for="emailAddress">Email Address</label>
                        <input id="email" type="text" class="form-control" value="add@gmail.com" placeholder="Email Address">
                    </div>
                    <div class="form-group" >
                        <label for="modal name">Modal name</label>
                        <input id="product" type="text" class="form-control" value="Input modal name" placeholder="modal name">
                    </div>
                    <div class="form-group" >
                        <label for="AppointmentDate">Apointment Date</label>
                        <input id="datePicker" type="date" class="form-control" placeholder="Set Apointment Date">
                    </div>
                    <div class="form-group" >
                        <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                            <input id="clockPicker" type="text" class="form-control">
                            <span class="input-group-addon">
                                <span class="glyphicon glyphicon-time"></span>
                            </span>
                        </div>
                    </div>


                    <div class="form-group">

                        <label class=" checkbox-inline">
                            <input id="isCommitted" type="checkbox" value="">Set Commit
                        </label>

                        <br><br>

                        <select id="callAction" class="form-control" id="exampleFormControlSelect1"style="width:50%;">
                            <option name="df" selected="selected">--Select Action--</option>
                            <option name="wn" style="font-weight: bold;">wrong number</option>
                            <option name="so" style="font-weight: bold;">switched off</option>
                            <option name="nr" style="font-weight: bold;">not reachable</option>
                            <option name="cni" style="font-weight: bold;">customer not interested</option>
                            <option name="cb" style="font-weight: bold;">callback</option>
                        </select>
                
                    </div>

                    <textarea id="comment" class="form-control" rows="4" placeholder="Your Feedback"></textarea>
                    <!-- <div class="clearfix"></div> -->
                </form>
            </div>
        </div>



        <div class="container">
            <div class="row">
                <div class="col-md-12 col-md-offset-1">
                    <h2>Previous Feedback</h2>
                    <table id="dataTable" class = "table table-hover dataTable">
                        <thead>
                            <tr>
                                <th style="border-bottom:2pt solid black;">#</th>
                                <th style="border-bottom:2pt solid black;">Feedback</th>
                                <th style="border-bottom:2pt solid black;">EmpID</th>
                                <th style="border-bottom:2pt solid black;">CreatedOn</th>

                            </tr>
                        </thead>
                        <tbody>
                            <!-- <tr>
                                <td>1</td>
                                <td>due to the wide spred use od table acress we have design a table to be opt-in just add</td>
                                <td>21-2-2017 11:22:30</td>
                            </tr>
                                
                            <tr>
                                <td>2 </td>
                                <td>due to the wide spred use od table acress we have design a table to be opt-in just add </td>
                                <td>21-2-2017 11:22:30 </td>
                            </tr> -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>


        <div class="container">
            <div class="row text-center">
                <div class="col-md-6 text-right">
                    <button id="updateButton" type="submit" class=" btn btn-primary">Update</button>
                </div>
                <div class="col-md-1 text-left">
                    <button id="callButton" type="submit" class=" btn btn-primary">Call now</button>
                </div>
            </div>
        </div>
        <br><br>

        <!-- <div class="row">
            <h3>Previous Feedback</h3>
            <table class="table">
                <thead class="thead-dark">
                    <tr>
                    <th scope="col">#</th>
                    <th scope="col">Feedback</th>
                    <th scope="col">Date Time</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">1</th>
                        <td>Due to the widespread use of tables across we’ve designed our tables to be opt-in. Just add </td>
                        <td>21/02/2017 11:20:34</td>
                    </tr>
                    <tr>
                        <th scope="row">2</th>
                        <td>Using the most basic table markup, here’s how .table-based tables look in Bootstrap. the parent.</td>
                        <td>21/02/2017 11:20:34</td>
                    </tr>
                    <tr>
                        <th scope="row">3</th>
                        <td>Create responsive tables by wrapping any .table with-width breakpoint of up to (but, respectively.</td>
                        <td>21/02/2017 11:20:34</td>
                    </tr>
                </tbody>
            </table>
        </div> -->
    </div>
{% endblock body_content %}


{% block custom_js %}
<script type="text/javascript">

    var leadID = localStorage.getItem("leadID");
    var phoneNumber = '';
	var table = $('#dataTable').DataTable({
        "columnDefs": [{
            "defaultContent": "-",
            "targets": "_all"
        }]
    });

    $(document).ready(function() {
        $.post( baseUrl + "getSingleLead/",
            {
                leadID: leadID
            },
            function(data, status) {
                dataObj = JSON.parse(data);
                if (dataObj.result == "fail") {
                    alert(dataObj.description)
                } else {
                    var fname = dataObj.description['fname'];
                    var lname = dataObj.description['lname'];
                    var address = dataObj.description['address'];
                    var phone = dataObj.description['phone'];
                    var product = dataObj.description['product'];
                    var alternatePhone = dataObj.description['alternatePhone'];
                    var email = dataObj.description['email'];    
                    var product = dataObj.description['product'];
                    var appointmentDate = dataObj.description['appointmentDate'];
                    var feedbacks = dataObj.description['feedbacks'];
                    var callAction = dataObj.description['callAction']

                    $("#phoneNumber").html(phone)
                    $("#leadName").val(fname + ' ' + lname)
                    $("#address").val(address)
                    $("#alternatePhone").val(alternatePhone)
                    $("#email").val(email)
                    $("#product").val(product)
                    $("#callAction option[name=" + callAction +"]").prop('selected', true);

                    //store phone number to the global variable to make available in another funciton
                    console.log(phone)
                    phoneNumber = phone


                    //handle comments here
                    if (feedbacks.length > 0) {
                        for (var i = 0; i < feedbacks.length; i++) {
                            var eachFeedback = feedbacks[i];

                            // console.log(eachFeedback)
                            
                            // var feedback = eachFeedback['feedback'];
                            
                            // var emp_id = eachFeedback['empID']; 

                            // console.log(feedback)
                            // console.log(emp_id)

                            // var createdAt = eachFeedback['createdAt'];

                            // console.log(createdAt)

                            table.row.add(
                                $(
                                    // '<tbody>' +
                                    '<tr>' +
                                        '<td>' + i + '</td>' +
                                        '<td>' + eachFeedback['feedback'] + '</td>' +
                                        '<td>' + eachFeedback['emp_id'] + '</td>' +
                                        '<td>' + eachFeedback['createdAt'] + '</td>' +
                                    '</tr>'  
                                    // '</tbody>'
                                )
                            ).draw(false);
                        }
                    }

                    var _d = Date.parse(appointmentDate);
                    var d = new Date(_d);
                    stringedDate = d.getFullYear() + '-' + ("0" + (d.getMonth() + 1)).slice(-2) + '-' + ("0" + (d.getDay() + 1)).slice(-2)
                    $("#datePicker").val(stringedDate)
                    var stringedTime = (("0" + d.getHours()).slice(-2) + ':' + ("0" + d.getMinutes()).slice(-2))
                    $("#clockPicker").val(stringedTime)
                }
            }
        )
    })

    $("#updateButton").click(function() {
        //This is dummy id for testing
        var leadID = localStorage.getItem("leadID");
        var emp_id = localStorage.getItem("empID");

        var fullName = $("#leadName").val();
        var nameArray = fullName.split(" ");
        var fname = nameArray[0];
        var lname = nameArray[1];
        var address = $("#address").val();
        var alternatePhone = $("#alternatePhone").val();
        var email = $("#email").val();
        var product = $("#product").val();
        var comment = $("#comment").val(); 
        var callAction = $("#callAction option:selected").attr("name")

        var _date = $("#datePicker").val();
        var _time = $("#clockPicker").val();
        var appointmentDate = _date + " " + _time + "." + "000000"

        var isCommitted = false;
        if ($("#isCommitted").prop("checked") == true) {
            isCommitted = true
        } 


        $.post( baseUrl + "editLead/",
        {
            emp_id: emp_id,
            leadID: leadID,
            fname: fname,
            lname: lname,
            address: address,
            email: email,
            alternatePhone: alternatePhone,
            product: product,
            comments: comment,
            callAction: callAction,
            isInterested: isCommitted,
            appointmentDate: appointmentDate
        },
        function(data, status) {
            var dataObj = JSON.parse(data);
            if (dataObj.result == "fail") {
                alert(dataObj.description)
            } else {
                location.reload()
                alert(dataObj.description)
            }
        })


    })


    $("#callButton").click(function() {
        var emp_id = localStorage.getItem("empID");
        var lead_id = localStorage.getItem("leadID");

        $.post( baseUrl + "makeCall/",
        {
            emp_id: emp_id,
            lead_id: lead_id,
            phone: phoneNumber
        },
        function(data, status){
            var dataObj = JSON.parse(data);
            if (dataObj.result === "fail") {
                alert(dataObj.description)
            } else {
                alert(dataObj.description)
            }
        })
    })













// ClockStuff

$('.clockpicker').clockpicker()
    .find('input').change(function(){
        console.log(this.value);
    });
var input = $('#single-input').clockpicker({
    placement: 'bottom',
    align: 'left',
    autoclose: true,
    'default': 'now'
});

$('.clockpicker-with-callbacks').clockpicker({
        donetext: 'Done',
        init: function() { 
            console.log("colorpicker initiated");
        },
        beforeShow: function() {
            console.log("before show");
        },
        afterShow: function() {
            console.log("after show");
        },
        beforeHide: function() {
            console.log("before hide");
        },
        afterHide: function() {
            console.log("after hide");
        },
        beforeHourSelect: function() {
            console.log("before hour selected");
        },
        afterHourSelect: function() {
            console.log("after hour selected");
        },
        beforeDone: function() {
            console.log("before done");
        },
        afterDone: function() {
            console.log("after done");
        }
    })
    .find('input').change(function(){
        console.log(this.value);
    });

// Manually toggle to the minutes view
$('#check-minutes').click(function(e){
    // Have to stop propagation here
    e.stopPropagation();
    input.clockpicker('show')
            .clockpicker('toggleView', 'minutes');
});
if (/mobile/i.test(navigator.userAgent)) {
    $('input').prop('readOnly', true);
}
</script>
<script src="https://weareoutman.github.io/clockpicker/assets/js/jquery.min.js"></script>
<script src="https://weareoutman.github.io/clockpicker/assets/js/bootstrap.min.js"></script>
<script src="https://weareoutman.github.io/clockpicker/dist/bootstrap-clockpicker.min.js"></script>
<script src="https://weareoutman.github.io/clockpicker/assets/js/highlight.min.js"></script>
<script type="text/javascript">
    $('.clockpicker').clockpicker();
</script>
{% endblock custom_js %}